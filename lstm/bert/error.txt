WARNING:tensorflow:From udc_train.py:41: RunConfig.__init__ (from tensorflow.contrib.learn.python.learn.estimators.run_config) is deprecated and will be removed in a future version.
Instructions for updating:
When switching to tf.estimator.Estimator, use tf.estimator.RunConfig instead.
WARNING:tensorflow:From /home/mpandey/.local/lib/python3.6/site-packages/tensorflow/contrib/learn/python/learn/estimators/estimator.py:1180: BaseEstimator.__init__ (from tensorflow.contrib.learn.python.learn.estimators.estimator) is deprecated and will be removed in a future version.
Instructions for updating:
Please replace uses of any Estimator from tf.contrib.learn with an Estimator from tf.estimator.*
INFO:tensorflow:Using config: {'_task_type': None, '_task_id': 0, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f3727c93160>, '_master': '', '_num_ps_replicas': 0, '_num_worker_replicas': 0, '_environment': 'local', '_is_chief': True, '_evaluation_master': '', '_train_distribute': None, '_eval_distribute': None, '_device_fn': None, '_tf_config': gpu_options {
  per_process_gpu_memory_fraction: 1.0
}
, '_tf_random_seed': None, '_save_summary_steps': 100, '_save_checkpoints_secs': 600, '_log_step_count_steps': 100, '_protocol': None, '_session_config': None, '_save_checkpoints_steps': None, '_keep_checkpoint_max': 5, '_keep_checkpoint_every_n_hours': 10000, '_model_dir': '/home/mpandey/ubuntu_dialogue/cs230_project/dialog-system-project/lstm/bert/runs/1544812607'}
WARNING:tensorflow:From /home/mpandey/ubuntu_dialogue/cs230_project/dialog-system-project/lstm/bert/udc_metrics.py:11: MetricSpec.__init__ (from tensorflow.contrib.learn.python.learn.metric_spec) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.estimator.EstimatorSpec.eval_metric_ops.
WARNING:tensorflow:From /home/mpandey/.local/lib/python3.6/site-packages/tensorflow/contrib/learn/python/learn/monitors.py:279: BaseMonitor.__init__ (from tensorflow.contrib.learn.python.learn.monitors) is deprecated and will be removed after 2016-12-05.
Instructions for updating:
Monitors are deprecated. Please use tf.train.SessionRunHook.
WARNING:tensorflow:From /home/mpandey/ubuntu_dialogue/cs230_project/dialog-system-project/lstm/bert/udc_inputs.py:46: read_batch_features (from tensorflow.contrib.learn.python.learn.learn_io.graph_io) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.data.
WARNING:tensorflow:From /home/mpandey/.local/lib/python3.6/site-packages/tensorflow/contrib/learn/python/learn/learn_io/graph_io.py:833: read_keyed_batch_features (from tensorflow.contrib.learn.python.learn.learn_io.graph_io) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.data.
WARNING:tensorflow:From /home/mpandey/.local/lib/python3.6/site-packages/tensorflow/contrib/learn/python/learn/learn_io/graph_io.py:542: read_keyed_batch_examples (from tensorflow.contrib.learn.python.learn.learn_io.graph_io) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.data.
WARNING:tensorflow:From /home/mpandey/.local/lib/python3.6/site-packages/tensorflow/contrib/learn/python/learn/learn_io/graph_io.py:423: string_input_producer (from tensorflow.python.training.input) is deprecated and will be removed in a future version.
Instructions for updating:
Queue-based input pipelines have been replaced by `tf.data`. Use `tf.data.Dataset.from_tensor_slices(string_tensor).shuffle(tf.shape(input_tensor, out_type=tf.int64)[0]).repeat(num_epochs)`. If `shuffle=False`, omit the `.shuffle(...)`.
WARNING:tensorflow:From /home/mpandey/.local/lib/python3.6/site-packages/tensorflow/python/training/input.py:276: input_producer (from tensorflow.python.training.input) is deprecated and will be removed in a future version.
Instructions for updating:
Queue-based input pipelines have been replaced by `tf.data`. Use `tf.data.Dataset.from_tensor_slices(input_tensor).shuffle(tf.shape(input_tensor, out_type=tf.int64)[0]).repeat(num_epochs)`. If `shuffle=False`, omit the `.shuffle(...)`.
WARNING:tensorflow:From /home/mpandey/.local/lib/python3.6/site-packages/tensorflow/python/training/input.py:188: limit_epochs (from tensorflow.python.training.input) is deprecated and will be removed in a future version.
Instructions for updating:
Queue-based input pipelines have been replaced by `tf.data`. Use `tf.data.Dataset.from_tensors(tensor).repeat(num_epochs)`.
WARNING:tensorflow:From /home/mpandey/.local/lib/python3.6/site-packages/tensorflow/python/training/input.py:197: QueueRunner.__init__ (from tensorflow.python.training.queue_runner_impl) is deprecated and will be removed in a future version.
Instructions for updating:
To construct input pipelines, use the `tf.data` module.
WARNING:tensorflow:From /home/mpandey/.local/lib/python3.6/site-packages/tensorflow/python/training/input.py:197: add_queue_runner (from tensorflow.python.training.queue_runner_impl) is deprecated and will be removed in a future version.
Instructions for updating:
To construct input pipelines, use the `tf.data` module.
WARNING:tensorflow:From /home/mpandey/.local/lib/python3.6/site-packages/tensorflow/contrib/learn/python/learn/learn_io/graph_io.py:317: TFRecordReader.__init__ (from tensorflow.python.ops.io_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Queue-based input pipelines have been replaced by `tf.data`. Use `tf.data.TFRecordDataset`.
WARNING:tensorflow:From /home/mpandey/.local/lib/python3.6/site-packages/tensorflow/contrib/learn/python/learn/learn_io/graph_io.py:449: shuffle_batch_join (from tensorflow.python.training.input) is deprecated and will be removed in a future version.
Instructions for updating:
Queue-based input pipelines have been replaced by `tf.data`. Use `tf.data.Dataset.interleave(...).shuffle(min_after_dequeue).batch(batch_size)`.
WARNING:tensorflow:From /home/mpandey/.local/lib/python3.6/site-packages/tensorflow/contrib/learn/python/learn/learn_io/graph_io.py:550: queue_parsed_features (from tensorflow.contrib.learn.python.learn.learn_io.graph_io) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.data.
WARNING:tensorflow:From /home/mpandey/ubuntu_dialogue/cs230_project/dialog-system-project/lstm/bert/udc_model.py:13: get_global_step (from tensorflow.contrib.framework.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Please switch to tf.train.get_global_step
WARNING:tensorflow:From /home/mpandey/.local/lib/python3.6/site-packages/tensorflow/contrib/learn/python/learn/estimators/estimator.py:1241: ModelFnOps.__new__ (from tensorflow.contrib.learn.python.learn.estimators.model_fn) is deprecated and will be removed in a future version.
Instructions for updating:
When switching to tf.estimator.Estimator, use tf.estimator.EstimatorSpec. You can use the `estimator_spec` method to create an equivalent one.
INFO:tensorflow:Create CheckpointSaverHook.
INFO:tensorflow:Graph was finalized.
2018-12-14 10:36:47.360541: I tensorflow/core/platform/cpu_feature_guard.cc:141] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA
2018-12-14 10:36:47.425945: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:964] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2018-12-14 10:36:47.426341: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1432] Found device 0 with properties: 
name: GeForce GTX 970 major: 5 minor: 2 memoryClockRate(GHz): 1.38
pciBusID: 0000:01:00.0
totalMemory: 3.94GiB freeMemory: 2.38GiB
2018-12-14 10:36:47.426360: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1511] Adding visible gpu devices: 0
2018-12-14 10:36:47.611227: I tensorflow/core/common_runtime/gpu/gpu_device.cc:982] Device interconnect StreamExecutor with strength 1 edge matrix:
2018-12-14 10:36:47.611254: I tensorflow/core/common_runtime/gpu/gpu_device.cc:988]      0 
2018-12-14 10:36:47.611259: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1001] 0:   N 
2018-12-14 10:36:47.611379: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1115] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 2073 MB memory) -> physical GPU (device: 0, name: GeForce GTX 970, pci bus id: 0000:01:00.0, compute capability: 5.2)
INFO:tensorflow:Running local_init_op.
INFO:tensorflow:Done running local_init_op.
WARNING:tensorflow:From /home/mpandey/.local/lib/python3.6/site-packages/tensorflow/python/training/monitored_session.py:804: start_queue_runners (from tensorflow.python.training.queue_runner_impl) is deprecated and will be removed in a future version.
Instructions for updating:
To construct input pipelines, use the `tf.data` module.
INFO:tensorflow:Saving checkpoints for 0 into /home/mpandey/ubuntu_dialogue/cs230_project/dialog-system-project/lstm/bert/runs/1544812607/model.ckpt.
INFO:tensorflow:loss = 52.699364, step = 0
INFO:tensorflow:global_step/sec: 417.736
INFO:tensorflow:loss = 23.134949, step = 100 (0.240 sec)
INFO:tensorflow:global_step/sec: 496.205
INFO:tensorflow:loss = 19.414291, step = 200 (0.202 sec)
INFO:tensorflow:global_step/sec: 511.1
INFO:tensorflow:loss = 15.368739, step = 300 (0.196 sec)
INFO:tensorflow:global_step/sec: 534.203
INFO:tensorflow:loss = 21.825077, step = 400 (0.187 sec)
INFO:tensorflow:global_step/sec: 513.979
INFO:tensorflow:loss = 21.329443, step = 500 (0.194 sec)
INFO:tensorflow:global_step/sec: 518.616
INFO:tensorflow:loss = 20.49704, step = 600 (0.193 sec)
INFO:tensorflow:global_step/sec: 524.84
INFO:tensorflow:loss = 16.177374, step = 700 (0.191 sec)
INFO:tensorflow:global_step/sec: 523.45
INFO:tensorflow:loss = 15.773369, step = 800 (0.191 sec)
INFO:tensorflow:global_step/sec: 513.715
INFO:tensorflow:loss = 16.146769, step = 900 (0.195 sec)
INFO:tensorflow:global_step/sec: 522.064
INFO:tensorflow:loss = 11.122253, step = 1000 (0.192 sec)
INFO:tensorflow:global_step/sec: 531.064
INFO:tensorflow:loss = 15.664311, step = 1100 (0.188 sec)
INFO:tensorflow:global_step/sec: 516.77
INFO:tensorflow:loss = 10.643521, step = 1200 (0.194 sec)
INFO:tensorflow:global_step/sec: 525.623
INFO:tensorflow:loss = 12.801146, step = 1300 (0.190 sec)
INFO:tensorflow:global_step/sec: 519.693
INFO:tensorflow:loss = 13.578466, step = 1400 (0.193 sec)
INFO:tensorflow:global_step/sec: 540.33
INFO:tensorflow:loss = 13.234643, step = 1500 (0.185 sec)
INFO:tensorflow:global_step/sec: 511.444
INFO:tensorflow:loss = 13.520519, step = 1600 (0.196 sec)
INFO:tensorflow:global_step/sec: 521.132
INFO:tensorflow:loss = 13.735693, step = 1700 (0.192 sec)
INFO:tensorflow:global_step/sec: 514.438
INFO:tensorflow:loss = 11.974085, step = 1800 (0.194 sec)
INFO:tensorflow:global_step/sec: 514.375
INFO:tensorflow:loss = 10.951197, step = 1900 (0.194 sec)
INFO:tensorflow:global_step/sec: 537.613
INFO:tensorflow:Starting evaluation at 2018-12-14-18:36:53
INFO:tensorflow:Graph was finalized.
2018-12-14 10:36:53.373736: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1511] Adding visible gpu devices: 0
2018-12-14 10:36:53.373776: I tensorflow/core/common_runtime/gpu/gpu_device.cc:982] Device interconnect StreamExecutor with strength 1 edge matrix:
2018-12-14 10:36:53.373782: I tensorflow/core/common_runtime/gpu/gpu_device.cc:988]      0 
2018-12-14 10:36:53.373787: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1001] 0:   N 
2018-12-14 10:36:53.373882: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1115] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 2073 MB memory) -> physical GPU (device: 0, name: GeForce GTX 970, pci bus id: 0000:01:00.0, compute capability: 5.2)
INFO:tensorflow:Restoring parameters from /home/mpandey/ubuntu_dialogue/cs230_project/dialog-system-project/lstm/bert/runs/1544812607/model.ckpt-0
INFO:tensorflow:Running local_init_op.
INFO:tensorflow:Done running local_init_op.
INFO:tensorflow:Finished evaluation at 2018-12-14-18:36:59
INFO:tensorflow:Saving dict for global step 0: global_step = 0, loss = 15.967855, recall_at_1 = 0.22597137014314927, recall_at_10 = 1.0, recall_at_2 = 0.358640081799591, recall_at_5 = 0.723159509202454
INFO:tensorflow:Validation (step 2000): recall_at_1 = 0.22597137014314927, recall_at_10 = 1.0, recall_at_2 = 0.358640081799591, recall_at_5 = 0.723159509202454, loss = 15.967855, global_step = 0
INFO:tensorflow:loss = 12.049273, step = 2000 (6.075 sec)
INFO:tensorflow:global_step/sec: 16.4657
INFO:tensorflow:loss = 12.345821, step = 2100 (0.184 sec)
INFO:tensorflow:global_step/sec: 533.205
INFO:tensorflow:loss = 8.062994, step = 2200 (0.187 sec)
INFO:tensorflow:global_step/sec: 513.75
INFO:tensorflow:loss = 10.323294, step = 2300 (0.195 sec)
INFO:tensorflow:global_step/sec: 528.707
INFO:tensorflow:loss = 10.02109, step = 2400 (0.189 sec)
INFO:tensorflow:global_step/sec: 519.274
INFO:tensorflow:loss = 12.932076, step = 2500 (0.193 sec)
INFO:tensorflow:global_step/sec: 515.992
INFO:tensorflow:loss = 11.470362, step = 2600 (0.194 sec)
INFO:tensorflow:global_step/sec: 515.03
INFO:tensorflow:loss = 13.742814, step = 2700 (0.194 sec)
INFO:tensorflow:global_step/sec: 530.147
INFO:tensorflow:loss = 8.670465, step = 2800 (0.189 sec)
INFO:tensorflow:global_step/sec: 504.472
INFO:tensorflow:loss = 10.757847, step = 2900 (0.198 sec)
INFO:tensorflow:global_step/sec: 510.412
INFO:tensorflow:loss = 9.7205715, step = 3000 (0.196 sec)
INFO:tensorflow:global_step/sec: 518.019
INFO:tensorflow:loss = 8.832077, step = 3100 (0.193 sec)
INFO:tensorflow:global_step/sec: 509.715
INFO:tensorflow:loss = 14.685488, step = 3200 (0.196 sec)
INFO:tensorflow:global_step/sec: 522.023
INFO:tensorflow:loss = 11.92067, step = 3300 (0.191 sec)
INFO:tensorflow:global_step/sec: 509.039
INFO:tensorflow:loss = 8.942659, step = 3400 (0.196 sec)
INFO:tensorflow:global_step/sec: 522.564
INFO:tensorflow:loss = 10.69236, step = 3500 (0.192 sec)
INFO:tensorflow:global_step/sec: 514.734
INFO:tensorflow:loss = 9.460207, step = 3600 (0.194 sec)
INFO:tensorflow:global_step/sec: 532.699
INFO:tensorflow:loss = 7.0306244, step = 3700 (0.188 sec)
INFO:tensorflow:global_step/sec: 511.977
INFO:tensorflow:loss = 9.434824, step = 3800 (0.195 sec)
INFO:tensorflow:global_step/sec: 515.526
INFO:tensorflow:loss = 11.507261, step = 3900 (0.194 sec)
INFO:tensorflow:global_step/sec: 518.676
INFO:tensorflow:loss = 11.251661, step = 4000 (0.194 sec)
INFO:tensorflow:global_step/sec: 501.8
INFO:tensorflow:loss = 7.5258183, step = 4100 (0.198 sec)
INFO:tensorflow:global_step/sec: 524.465
INFO:tensorflow:loss = 8.37903, step = 4200 (0.191 sec)
INFO:tensorflow:global_step/sec: 528.644
INFO:tensorflow:loss = 13.510556, step = 4300 (0.189 sec)
INFO:tensorflow:global_step/sec: 530.581
INFO:tensorflow:loss = 6.2477007, step = 4400 (0.189 sec)
INFO:tensorflow:global_step/sec: 512.761
INFO:tensorflow:loss = 7.4241376, step = 4500 (0.195 sec)
INFO:tensorflow:global_step/sec: 517.714
INFO:tensorflow:loss = 13.035864, step = 4600 (0.193 sec)
INFO:tensorflow:global_step/sec: 530.937
INFO:tensorflow:loss = 9.716685, step = 4700 (0.189 sec)
INFO:tensorflow:global_step/sec: 521.543
INFO:tensorflow:loss = 7.2972918, step = 4800 (0.192 sec)
INFO:tensorflow:global_step/sec: 516.324
INFO:tensorflow:loss = 8.774977, step = 4900 (0.194 sec)
INFO:tensorflow:global_step/sec: 519.276
INFO:tensorflow:loss = 8.961901, step = 5000 (0.193 sec)
INFO:tensorflow:global_step/sec: 530.068
INFO:tensorflow:loss = 3.7780464, step = 5100 (0.189 sec)
INFO:tensorflow:global_step/sec: 524.973
INFO:tensorflow:loss = 10.885036, step = 5200 (0.191 sec)
INFO:tensorflow:global_step/sec: 506.75
INFO:tensorflow:loss = 7.6227865, step = 5300 (0.197 sec)
INFO:tensorflow:global_step/sec: 520.095
INFO:tensorflow:loss = 6.3045225, step = 5400 (0.192 sec)
INFO:tensorflow:global_step/sec: 519.012
INFO:tensorflow:loss = 5.3432384, step = 5500 (0.193 sec)
INFO:tensorflow:global_step/sec: 511.296
INFO:tensorflow:loss = 10.461168, step = 5600 (0.195 sec)
INFO:tensorflow:global_step/sec: 544.97
INFO:tensorflow:loss = 7.25997, step = 5700 (0.184 sec)
INFO:tensorflow:global_step/sec: 520.768
INFO:tensorflow:loss = 7.3197274, step = 5800 (0.192 sec)
INFO:tensorflow:global_step/sec: 514.35
INFO:tensorflow:loss = 13.503156, step = 5900 (0.194 sec)
INFO:tensorflow:global_step/sec: 515.376
INFO:tensorflow:loss = 7.201286, step = 6000 (0.194 sec)
INFO:tensorflow:global_step/sec: 511.113
INFO:tensorflow:loss = 8.8160305, step = 6100 (0.196 sec)
INFO:tensorflow:global_step/sec: 520.674
INFO:tensorflow:loss = 8.899367, step = 6200 (0.192 sec)
INFO:tensorflow:global_step/sec: 527.971
INFO:tensorflow:loss = 8.374871, step = 6300 (0.190 sec)
INFO:tensorflow:global_step/sec: 527.872
INFO:tensorflow:loss = 6.8511972, step = 6400 (0.190 sec)
INFO:tensorflow:global_step/sec: 515.264
INFO:tensorflow:loss = 5.215617, step = 6500 (0.194 sec)
INFO:tensorflow:global_step/sec: 506.051
INFO:tensorflow:loss = 7.043085, step = 6600 (0.198 sec)
INFO:tensorflow:Error reported to Coordinator: <class 'tensorflow.python.framework.errors_impl.DataLossError'>, corrupted record at 3954713101
	 [[{{node read_batch_features_train/read/ReaderReadUpToV2}} = ReaderReadUpToV2[_device="/job:localhost/replica:0/task:0/device:CPU:0"](read_batch_features_train/read/TFRecordReaderV2, read_batch_features_train/file_name_queue, read_batch_features_train/read/ReaderReadUpToV2/num_records)]]
INFO:tensorflow:Saving checkpoints for 6619 into /home/mpandey/ubuntu_dialogue/cs230_project/dialog-system-project/lstm/bert/runs/1544812607/model.ckpt.
Context shape (?, 768)
Utterance shape (?, 768)
Context shape (?, 768)
Utterance shape (?, 768)
Traceback (most recent call last):
  File "udc_train.py", line 66, in <module>
    tf.app.run()
  File "/home/mpandey/.local/lib/python3.6/site-packages/tensorflow/python/platform/app.py", line 125, in run
    _sys.exit(main(argv))
  File "udc_train.py", line 62, in main
    estimator.fit(input_fn=input_fn_train, steps=None, monitors=[eval_monitor])
  File "/home/mpandey/.local/lib/python3.6/site-packages/tensorflow/python/util/deprecation.py", line 488, in new_func
    return func(*args, **kwargs)
  File "/home/mpandey/.local/lib/python3.6/site-packages/tensorflow/contrib/learn/python/learn/estimators/estimator.py", line 525, in fit
    loss = self._train_model(input_fn=input_fn, hooks=hooks)
  File "/home/mpandey/.local/lib/python3.6/site-packages/tensorflow/contrib/learn/python/learn/estimators/estimator.py", line 1095, in _train_model
    _, loss = mon_sess.run([model_fn_ops.train_op, model_fn_ops.loss])
  File "/home/mpandey/.local/lib/python3.6/site-packages/tensorflow/python/training/monitored_session.py", line 783, in __exit__
    self._close_internal(exception_type)
  File "/home/mpandey/.local/lib/python3.6/site-packages/tensorflow/python/training/monitored_session.py", line 821, in _close_internal
    self._sess.close()
  File "/home/mpandey/.local/lib/python3.6/site-packages/tensorflow/python/training/monitored_session.py", line 1069, in close
    self._sess.close()
  File "/home/mpandey/.local/lib/python3.6/site-packages/tensorflow/python/training/monitored_session.py", line 1229, in close
    ignore_live_threads=True)
  File "/home/mpandey/.local/lib/python3.6/site-packages/tensorflow/python/training/coordinator.py", line 389, in join
    six.reraise(*self._exc_info_to_raise)
  File "/home/mpandey/.local/lib/python3.6/site-packages/six.py", line 692, in reraise
    raise value.with_traceback(tb)
  File "/home/mpandey/.local/lib/python3.6/site-packages/tensorflow/python/training/queue_runner_impl.py", line 257, in _run
    enqueue_callable()
  File "/home/mpandey/.local/lib/python3.6/site-packages/tensorflow/python/client/session.py", line 1257, in _single_operation_run
    self._call_tf_sessionrun(None, {}, [], target_list, None)
  File "/home/mpandey/.local/lib/python3.6/site-packages/tensorflow/python/client/session.py", line 1407, in _call_tf_sessionrun
    run_metadata)
tensorflow.python.framework.errors_impl.DataLossError: corrupted record at 3954713101
	 [[{{node read_batch_features_train/read/ReaderReadUpToV2}} = ReaderReadUpToV2[_device="/job:localhost/replica:0/task:0/device:CPU:0"](read_batch_features_train/read/TFRecordReaderV2, read_batch_features_train/file_name_queue, read_batch_features_train/read/ReaderReadUpToV2/num_records)]]
